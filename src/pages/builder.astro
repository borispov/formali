---
import Layout from "../layouts/Layout.astro"
import Builder from "../components/SvelteForm/Builder.svelte"
import { ObjectId } from "mongodb"

import { formsCollection } from "$lib/db"

let form = null
let formId = Astro.url.searchParams.get('form')
console.log('formid url params: ', formId)

const locals = Astro.locals
console.log(locals.pb.authStore.isVaild)

// substitute with PocketBase collections
// if (formId){
//   const f = await formsCollection()
//   form = await f.findOne({ _id: new ObjectId(formId) })
//   // if form with that form id does not exist, redirect
//   if (!form) Astro.redirect('/dashboard')
//   else form.id = new Object(formId).toString()
// } else {
//   Astro.redirect('/dashboard')
// }

---

<Layout title="builder">
  <Builder formId={formId} formData={form ?? null} client:only="svelte" />
</Layout>