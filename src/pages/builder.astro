---
import Layout from "../layouts/Layout.astro"
import Builder from "../components/SvelteForm/Builder.svelte"
import { ObjectId } from "mongodb"

import { formsCollection } from "$lib/db"

let formId = Astro.url.searchParams.get('form')
let form

if (formId){
  const f = await formsCollection()
  form = await f.findOne({ _id: new ObjectId(formId) })
  // if form with that form id does not exist, redirect
  if (!form) Astro.redirect('/dashboard')
  else form.id = new Object(formId).toString()
} else {
  Astro.redirect('/dashboard')
}

---

<Layout title="builder">
  <Builder formData={form} client:only="svelte" />
</Layout>